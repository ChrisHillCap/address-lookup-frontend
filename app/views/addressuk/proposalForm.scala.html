@*
* Copyright 2016 HM Revenue & Customs
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*@
@import address.ViewConfig
@(tag: String,
  view: ViewConfig,
  addressForm: Form[address.uk.UkAddressData],
  addressList: List[uk.gov.hmrc.address.v2.AddressRecord],
  selectedUprnId: String,
  canEdit: Boolean,
  editUrl: String)(implicit request: Request[_], messages: Messages)

@import uk.gov.hmrc.play.views.html.helpers
@import config.Plural._

@main_template(view = view, bodyClasses = Some("proposal-form")) {

<div>
    <h1 class="heading-xlarge">@{view.baseTitle}</h1>

    <legend class="visuallyhidden">@{view.prompt}</legend>

    <label class="form-label-bold" for="location">@{view.prompt}</label>
    <fieldset class="inline">
        <div class="panel panel-border-narrow" id='UK-Tab'>
        @helpers.form( address.uk.routes.UkAddressLookupController.postSelected(tag), 'id -> "myForm"  ) {
            <input type='hidden' id='guid' name='guid' value='@addressForm("guid").value.get' />
            <input type='hidden' id='continue-url' name='continue-url' value='@addressForm("continue-url").value.get' />
            <input type="hidden" id='back-url' name='back-url' value='@addressForm("back-url").value.getOrElse("")' />
            <input type="hidden" id='back-text' name='back-text' value='@addressForm("back-text").value.getOrElse("")' />
            <input type='hidden' id='country-code' name='country-code' value='@addressForm("country-code").value.getOrElse("")' />
            <input type='hidden' id='prev-house-name-number' name='prev-house-name-number' value='@addressForm("prev-house-name-number").value.getOrElse("")' />
            <input type='hidden' id='prev-postcode'          name='prev-postcode'          value='@addressForm("prev-postcode").value.getOrElse("")' />

            <div class="form-group">
                @helper.inputText(addressForm("house-name-number"),  'class -> "form-control",  '_label -> "Building name or number" )
            </div>


            <div class="form-group">
                @helper.inputText(addressForm("postcode"),  'class -> "form-control",  '_label -> "Post code",  'maxlength -> "8"  )
            </div>

            <div id="found-addresses" class="form-group">
                <label class="form-label-bold" for="Address-table">Found @{plural(addressList, "address", "addresses")}</label>
                <table id="Address-table">
                    <tbody>
                    @for(a <- addressList) {
                        <tr>
                            <td class="selection"><input id='a@{a.id}'
                                type="radio" name="radio-inline-group"
                                @if(a.id==selectedUprnId) {
                                    checked="checked"
                                }
                                value='@{a.id}' />
                            </td>
                            <td><label for='a@{a.id}'
                                >@{a.address.printable}
                            </label>
                            @if(view.allowManualEntry && editUrl.nonEmpty) {
                                <span class="edit-link"><a href="@{editUrl}&editId=@{a.id}">(edit)</a></span>
                            }
                            </td>
                        </tr>
                    }
                    </tbody>
                </table>
            </div>

            @if(view.allowManualEntry && canEdit) {
                <div class="form-group">
                    <h2>Amend address</h2>
                    <dl id="address-lines_field">
                        <dt><label for="address-lines">Address lines</label></dt>
                        <dd>
                            <textarea type="text" id="address-lines" name="address-lines" rows="3" class="form-control"
                            >@{addressForm("address-lines").value.getOrElse("")}</textarea>
                        </dd>
                    </dl>
                    @helper.inputText(addressForm("town"), 'class -> "form-control", '_name -> "Nearest town or city" )
                    @helper.inputText(addressForm("county"), 'class -> "form-control", '_name -> "County" )
                </div>
            }

            <div class="form-group">
                <button type="submit" name="submit" value="continue">Continue</button>
            </div>
        }
        </div>
        <div class="grid-wrapper nav">
            <a class="page-nav__link page-nav__link--previous"
            title="Navigate to previous page)" rel="prev" href="@address.uk.routes.UkAddressLookupController.getEmptyForm(tag, Some(addressForm.get.guid), Some(addressForm.get.continue), addressForm.get.backUrl, addressForm.get.backText).url">
                <span class="page-nav__label">Previous</span>
                <span class="page-nav__title">Address Details</span>
            </a>
        </div>
    </fieldset>

</div>
}
