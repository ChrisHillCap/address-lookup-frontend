@*
* Copyright 2016 HM Revenue & Customs
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*@

@(ix: Int,
  view: address.uk.ViewConfig,
  ukAddrForm: Form[address.uk.AddressForm],
  addressList: List[address.uk.AddressRecord],
  selected: Int,
  noMatchesWereFound: Boolean)(implicit request: Request[_])

@import uk.gov.hmrc.play.views.html.helpers

@main_template(title = view.title, bodyClasses = None) {

<div>
    <h1 class="heading-xlarge">Your Address</h1>

    <legend class="visuallyhidden">Choose your location</legend>

    <label class="form-label-bold" for="location">Choose your location</label>
    <fieldset class="inline">
        <div class="panel panel-border-narrow" id='UK-Tab'>
        @helpers.form( address.uk.routes.AddressLookupController.postSelected(ix), 'id -> "myForm"  ) {
            <input type='hidden' id='continue-url' name='continue-url' value='@ukAddrForm("continue-url").value.get' />

            @if(!noMatchesWereFound && addressList.isEmpty) {
            <div class="form-group">
                <label class="form-checkbox" for="no-fixed-address">
                    <input id="no-fixed-address" name="no-fixed-address" type="checkbox" value="true">
                    I have no fixed address
                </label>
            </div>
            }

            <div class="form-group">
                @helper.inputText(ukAddrForm("house-name-number"),  'class -> "form-control",  '_label -> "Building name or number" )
            </div>


            <div class="form-group">
                @helper.inputText(ukAddrForm("postcode"),  'class -> "form-control",  '_label -> "Post code",  'maxlength -> "8"  )
            </div>

            @if(addressList.size > view.maxAddressesToShow) {
                <div class="form-group">
                    <div class="warning-box">
                        <h3>More than @view.maxAddressesToShow addresses were found</h3>
                        <p>Please enter the first line of your address.</p>
                    </div>
                </div>
            }

            @if(noMatchesWereFound) {
                <div class="form-group">
                    <div class="warning-box">
                        <h3>No addresses were found for this postcode</h3>
                        <p>Please enter a postcode or select 'edit this address'.</p>
                    </div>
                </div>
            }

            @if(!noMatchesWereFound && addressList.nonEmpty && addressList.size <= view.maxAddressesToShow) {
                <div class="form-group">
                    @if(addressList.size == 1) {
                        <label class="form-label-bold" for="Address-table">Found address</label>
                        <table id="Address-table">
                            <tbody>
                                <tr>
                                    <td class="selection"><input id='a@{
                                        addressList.head.uprn.get
                                    }' type="radio" name="radio-inline-group" checked='checked' value='@{
                                        addressList.head.uprn.get
                                    }'>
                                    </td>
                                    <td><label for='a@{
                                        addressList.head.uprn.get
                                    }'>@{
                                        addressList.head.address.printable
                                    }</label>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    } else {
                        <label class="form-label-bold" for="Address-table">Found addresses</label>
                        <table id="Address-table">
                            <tbody>
                            @for(i <- addressList.indices) {
                                <tr>
                                    <td class="selection"><input id='a@{addressList(i).uprn.get}'
                                        type="radio" name="radio-inline-group"
                                        @if(selected == i) {
                                            checked="checked"
                                        }
                                        value='@{addressList(i).uprn.get}' />
                                    </td>
                                    <td><label for='a@{addressList(i).uprn.get}'
                                        >@{addressList(i).address.printable}</label>
                                    </td>
                                </tr>
                            }
                            </tbody>
                        </table>
                    }
                </div>
            }

            @if(view.allowManualEntry && selected >= 0) {
                <div class="form-group">
                    <h2>Amend address</h2>
                    @helper.inputText(ukAddrForm("address-line1"),  'class -> "form-control", '_name -> "Address line 1" )
                    @helper.inputText(ukAddrForm("address-line2"),  'class -> "form-control",  '_name -> "Address line 2"  )
                    @helper.inputText(ukAddrForm("address-line3"),  'class -> "form-control",  '_name -> "Address line 3"  )
                    @helper.inputText(ukAddrForm("town"),  'class -> "form-control",  '_name -> "Nearest town or city"  )
                    @helper.inputText(ukAddrForm("address-county"),  'class -> "form-control",  '_name -> "County"  )

                </div>
            }

            <div class="form-group">
                <button type="submit" name="submit" value="continue">Continue</button>
                @if(view.allowManualEntry && addressList.nonEmpty && addressList.size <= view.maxAddressesToShow) {
                    <span class="edit-link">or <a href="#" id="editAddress">edit this address</a></span>
                }
            </div>
        }
        </div>
    </fieldset>

</div>
}
